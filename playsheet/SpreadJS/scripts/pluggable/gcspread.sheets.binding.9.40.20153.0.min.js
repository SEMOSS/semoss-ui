/*
 *
 * SpreadJS Library 9.40.20153.0
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 *
 * Licensed under the SpreadJS Commercial License. 
 * spread.sales@grapecity.com
 * http://spread.grapecity.com/Pages/Spread-JS-License/
 *
 *
 **/
var GcSpread;(function(n){(function(n){var s,r;n.feature("binding",["core.common"]);var t=null,e=undefined,i="undefined",f="function",o="string",u=function(){function n(n){this._source=n;this.__cellBindingSource__=!0}return n.prototype.setValue=function(n,t){this._source&&n&&r.setValueByPath(this._source,n,t)},n.prototype.getValue=function(n){return this._source&&n?r.getValueByPath(this._source,n):t},n.prototype.getSource=function(){return this._source},n}();n.CellBindingSource=u;s=function(){function s(n){this._init();this._sheet=n}return s.prototype.bind=function(t){var i=this,r=i._dataSource;r&&n.GC$.isFunction(r.dispose)&&r.dispose();i._unSubscribeHandlers(i._dataSourceSubscriptions);i._unSubscribeHandlers(i._dataItemSubscriptions);i._init();i._dataSource=t;t&&(i._dataSourceType=i._getDataSourceType(t),i._dataItemType=i.getDataItemType(),i._sheet&&(t.subscribe&&i._dataSourceSubscriptions.push(t.subscribe(i._dataChangedhandler,i)),t.currentPosition&&t.currentPosition.subscribe&&i._dataSourceSubscriptions.push(t.currentPosition.subscribe(i._currentPositionChangedhandler,i)),i.doDataItemChanged()),i._fields=i._getFieldsInfo())},s.prototype.doDataItemChanged=function(){var r=this,u,e,o;if(r._sheet&&r._dataSource){var s=r._sheet,f=r._dataSource,h=r._dataSourceType;if(f&&n.GC$.getType(window.ko)!==i&&(r._unSubscribeHandlers(r._dataItemSubscriptions),u=t,h===3?(f.currentPosition&&(e=s.getActiveRowIndex(),-1<=e&&e<f.count()&&f.currentPosition(e)),u=f.currentItem()):h===4||(u=f[s.getActiveColumnIndex()]),u))for(o in u)u[o]&&n.GC$.isFunction(u[o].subscribe)&&r._dataItemSubscriptions.push(u[o].subscribe(r._activeDataItemChangedhandler,t,t))}},s.prototype._activeDataItemChangedhandler=function(){this._sheet&&this._sheet.repaint()},s.prototype._unSubscribeHandlers=function(t){var r,i;if(t)for(r in t)i=t[r],i&&n.GC$.isFunction(i.dispose)&&i.dispose()},s.prototype.getRowCount=function(){return this._getDataLength()},s.prototype.getColumnCount=function(){var i,r,t;return this._fields?this._fields.length:(i=this._dataSource,i&&(r=i[0],t=n.GC$.getType(r),t==="null"||t==="string"||t==="number"))?1:0},s.prototype.getSource=function(){return this._dataSource},s.prototype.getFields=function(){return this._fields},s.prototype.getDataItem=function(n){if(!this._dataSource)return t;var r=this._dataSource,i=this._dataSourceType;if(i===1)return r[n];else if(i===4)return t;else if(i===2)return r()[n];else if(i===3)return r.item(n);return t},s.prototype.getDataItemType=function(){var i,t,n;if(!this._dataItemType)for(i=this.getRowCount(),t=0;t<i;t++)if(n=this.getDataItem(t),n){n.entityAspect&&n.entityType&&(this._dataItemType=n.entityType);this._dataItemType=n.constructor;break}return this._dataItemType},s.prototype.getValue=function(u,f){var s=this,c={value:t,hasBinding:!1},b,p,e;if(!s._dataSource)return c;var l=s._sheet,y="function",w="string",a=s._dataSource,v=s._dataSourceType,o,h;if(v!==4){if(u<0||s.getRowCount()<=u||(b=l?l.getColumnCount():s.getColumnCount(),f<0||b<=f))return c;l?(o=l._sheetModelManager.getColInfos()._getItems()[f],o&&(h=o.name)):s._fields&&(h=s._fields[f])}if(v===1){if(e=a[u],typeof e===i||e===t)return c;if(o&&typeof o.value===y)return{value:o.value(e),hasBinding:!0};else if(h)return{value:r.getValueByPath(e,h),hasBinding:!0};else if((n.GC$.getType(e)===w||n.GC$.isNumeric(e))&&f===0)return{value:e,hasBinding:!0}}else if(v===2){if(e=a()[u],typeof e===i||e===t)return c;if(o&&typeof o.value===y)return{value:o.value(e),hasBinding:!0};else if(h)return{value:r.getValueByPath(e,h),hasBinding:!0};else if((n.GC$.getType(e)===w||n.GC$.isNumeric(e))&&f===0)return{value:e,hasBinding:!0}}else if(v===4){if(p=l?l.getBindingPath(u,f):t,p)return{value:a.getValue(p),hasBinding:!0}}else if(v===3){if(e=a.item(u),typeof e===i||e===t)return c;if(o&&typeof o.value===y)return{value:o.value(e),hasBinding:!0};else if(h)return{value:a.getProperty(e,h),hasBinding:!0}}return c},s.prototype.setValue=function(u,e,s){var a=this,k,l,b,h;if(!a._dataSource)return!1;var p=a._sheet,y=a._dataSource,w=a._dataSourceType,d=n._DataSourceType,c,v;if(w!==4){if(u<0||a.getRowCount()<=u||(k=p?p.getColumnCount():a.getColumnCount(),e<0||k<=e))return!1;p?(c=p._sheetModelManager.getColInfos()._getItems()[e],c&&(v=c.name)):a._fields&&(v=a._fields[e])}return l=!1,w===1?(h=y[u],h!==t&&typeof h!==i&&(c&&typeof c.value===f?(c.value(h,s),l=!0):v?(r.setValueByPath(h,v,s),l=!0):(n.GC$.getType(h)===o||n.GC$.isNumeric(h))&&e===0&&(y[u]=s,l=!0))):w===2?(h=y()[u],h!==t&&typeof h!==i&&(c&&typeof c.value===f?(c.value(h,s),l=!0):v?(r.setValueByPath(h,v,s),l=!0):(n.GC$.getType(h)===o||n.GC$.isNumeric(h))&&e===0&&(y()[u]=s,l=!0))):w===4?(b=p?p.getBindingPath(u,e):t,b&&(y.setValue(b,s),l=!0)):w===3&&(h=y.item(u),h!==t&&typeof h!==i&&(c&&typeof c.value===f?(c.value(h,s),l=!0):v&&(y.setProperty(h,v,s),l=!0))),l},s.prototype.addItems=function(n,i){var r=this,f,o;if(r._dataSource&&!(n>r.getRowCount())){var e=r._dataSource,s=r._dataSourceType,u=r.getDataItemType();if(s===3){if(!r._dataViewUpdating){if(r._updatingDataView=!0,u){for(f=0;f<i;f++)o=u.createEntity?u.createEntity():new u,e.add(o);e.commitEdit()}r._updatingDataView=!1}}else if(s!==4)for(f=0;f<i;f++)u?(o=u.createEntity?u.createEntity():new u,e.splice(n,0,o)):e.splice(n,0,t)}},s.prototype.removeItems=function(n,t){var i=this,r=i.getRowCount(),f;if(i._dataSource&&!(n>=r)){var u=i._dataSource,e=i._dataSourceType,o=Math.min(t,r-n);if(e===3){if(!i._dataViewUpdating){for(i._updatingDataView=!0,f=0;f<o;f++)u.remove(u.item(n));i._updatingDataView=!1}}else e===4||n<r&&u.splice(n,o)}},s.isDataViewSource=function(n){var t=window.wijmo;return t&&t.data&&t.data.isDataView&&t.data.isDataView(n)},s.isCellBindingSource=function(n){return u&&n instanceof u||n&&n.hasOwnProperty("__cellBindingSource__")},s.prototype._init=function(){var n=this;n._dataSource=t;n._dataSourceType=0;n._dataItemType=t;n._fields=t;n._dataSourceSubscriptions=[];n._dataItemSubscriptions=[]},s.prototype._getDataSourceType=function(n){if(n){var t=window.ko;if(s.isDataViewSource(n))return 3;else if(t&&t.isObservable(n))return 2;else if(s.isCellBindingSource(n))return 4;else if(n&&!isNaN(n.length))return 1}return 0},s.prototype._getDataLength=function(){var t=this._dataSource,i=this._dataSourceType,n;return t?(n=0,i===1?n=t.length:i===2?n=t().length:i===4||i===3&&(n=t.count()),n):0},s.prototype._getFieldsInfo=function(){var o=this,u=o._dataSource,s=o._dataSourceType,e=0,f=0,r=t,n,i;if(s===1){if(e=u.length,e>0&&(n=o._getProperties(u[0]),n&&n.length>0))for(f=n.length,r=[],i=0;i<f;i++)r.push(n[i])}else if(s===2){if(e=u().length,e>0&&(n=o._getProperties(u()[0]),n&&n.length>0))for(f=n.length,r=[],i=0;i<f;i++)r.push(n[i])}else if(s!==4&&s===3&&(e=u.count(),n=u.getProperties(),n&&n.length>0))for(f=n.length,r=[],i=0;i<f;i++)r.push(n[i].name);return r},s.prototype._getProperties=function(t){var f=window.ko,u=[];for(var r in t)n.GC$.isFunction(t[r])?typeof f!==i&&f.isObservable(t[r])&&u.push(r):u.push(r);return u},s.prototype._dataChangedhandler=function(n){var i=this,r;i._updatingDataView||i._sheet&&(r=i._sheet,r._bindToAutoRefresh(function(n){var e,f,u,o;if(n){if(i._dataViewUpdating=!0,!isNaN(n.length)&&(r._setRowCountInternal(n.length),(i._fields===t||i._fields===undefined)&&r._sheetModelManager.getColInfos()._getItems().length===0&&(i._fields=i._getFieldsInfo(),r.setColumnCount(i.getColumnCount()),e=r._sheetModelManager.getColInfos(),f=i.getFields(),f)))for(u=0,o=f.length;u<o;u++)e._setItem(u,{name:f[u]});i._dataViewUpdating=!1}})(n))},s.prototype._currentPositionChangedhandler=function(n){var i=this,t,r;i._dataSource&&i._sheet&&(t=i._sheet,r=i._dataSource,t._bindToAutoRefresh(function(n){if(r.currentPosition){var i=r.currentPosition();t._activeRowIndex!==i&&t._setActiveCellAndSelection(i,t._activeColIndex,e,e,2)}})(n))},s.prototype.toJSON=function(){var n=this._dataSource,i;return n?(i=this._dataSourceType,i===2?n=n():i===4?n=n.getSource():i===3&&(n=n.local),{type:i,source:n}):t},s.prototype.fromJSON=function(n,t){var i=n&&n.source,f,r;i&&(f=n.type,f===2?(r=window.ko,r&&r.observableArray&&this.bind(r.observableArray(i))):f===4?this.bind(new u(i)):this.bind(i))},s}();n._BindingManager=s;r=function(){function n(){}return n.setValueByPath=function(n,t,r){var f,u;if(n&&t){var e=window.ko,o="function",s=t.split("."),h=s.length;for(f=0;f<h;f++){if(u=s[f],!n)break;f===h-1?typeof n[u]===o?(typeof e===i||!e.isObservable(n[u])||e.isWriteableObservable(n[u]))&&n[u](r):n[u]=r:n=typeof n[u]===o?n[u]():n[u]}}},n.getValueByPath=function(n,r){var u;if(!n||!r)return t;var f=r.split("."),o=f.length,e=0;do if(u=f[e],n=typeof n[u]=="function"?n[u]():n[u],n===t||typeof n===i)return t;while(++e<o);return n},n}();n._BindingHelper=r})(n.Sheets||(n.Sheets={}));var t=n.Sheets})(GcSpread||(GcSpread={}))
